select sell_data.sell_id 
                        	,pro_sell_price
                        	,pro_data.pro_id
                        	,pro_data.pro_code
                            ,sell_data.con_type_nm_kh
                            ,(case 
                            	when (COALESCE(sell_data.pro_sell_price, '') = '')
                                	then  book_data.pro_book_price
                                else sell_data.pro_sell_price
                             end) as sell_price
                            ,(case 
                            	when (COALESCE(sell_data.pro_sell_price, '') = '')
                                	then  cus_book_data.cus_nm
                                else cus_sell_data.cus_nm
                             end) as cus_name
                            ,sell_data.inst_amt_pay
                            ,sell_data.inst_date
                        	,inst_pay_data.inst_total_paid_amount
                            ,inst_pay_data.inst_paid_des
                            ,inst_pay_data.inst_paid_date
                            ,other_pay.other_pay_amount
                            ,other_pay.other_pay_des
                            ,other_pay.other_pay_date
                            ,book_data.con_total_price as book_amount
                            ,book_data.con_des as book_des
                            ,book_data.con_date
                            
                        from (select pro_id,pro_code from tbl_product where useYn ='Y') pro_data
                        left join (select tbl_product.pro_id
                                   ,tbl_sell.sell_id	
                                   ,pro_sell_price
                                   	,con_type_nm_kh
                                    ,inst_amt_pay
                                   ,DATE_FORMAT(sell_date, '%d/%m/%Y') as sell_date
                                   ,DATE_FORMAT(inst_date, '%d/%m/%Y') as inst_date
                                   	from tbl_sell
                                   	inner join tbl_sell_detail on tbl_sell_detail.sell_id = tbl_sell.sell_id
                                    inner join tbl_product on tbl_product.pro_id = tbl_sell_detail.pro_id
                                    inner join tbl_contract_type on tbl_contract_type.con_type_id = tbl_sell.con_type_id
                                    left join tbl_installment on tbl_installment.sell_id = tbl_sell.sell_id and tbl_installment.useYn = 'Y' and inst_date BETWEEN '2020-03-01' and '2020-03-31'
                                    where tbl_sell.useYn ='Y'
                                   ) sell_data 
                        on pro_data.pro_id = sell_data.pro_id
                        left join (select tbl_sell.sell_id
                                   ,sum(inst_total_paid_amount) as inst_total_paid_amount
                                   ,GROUP_CONCAT(inst_paid_des SEPARATOR ' - ') as inst_paid_des
                                   ,GROUP_CONCAT(DATE_FORMAT(inst_paid_date, '%d/%m/%Y') SEPARATOR ' - ') as inst_paid_date
                                   	from tbl_sell
                                   	inner join tbl_sell_detail on tbl_sell_detail.sell_id = tbl_sell.sell_id
                                    left join tbl_installment on tbl_installment.sell_id = tbl_sell.sell_id and tbl_installment.useYn = 'Y'
                                    left join tbl_installment_payment on tbl_installment_payment.inst_id = tbl_installment.inst_id and tbl_installment_payment.useYn = 'Y' and tbl_installment_payment.inst_paid_yn = 'Y' and inst_paid_date BETWEEN '2020-03-01' and '2020-03-31'
                                    where tbl_sell.useYn ='Y'
                        			GROUP BY sell_id
                                   ) inst_pay_data 
                        on sell_data.sell_id = inst_pay_data.sell_id 
                        left join (select tbl_contract_detail.pro_id
                                   ,tbl_contract.con_id
                                   ,con_total_price
                                   ,tbl_contract_detail.pro_book_price
                                   ,tbl_contract.con_des
                                   ,DATE_FORMAT(con_date, '%d/%m/%Y') as con_date
                                   from tbl_contract 
                                   inner join tbl_contract_detail on tbl_contract_detail.con_id = tbl_contract.con_id
                                   where tbl_contract.useYn = 'Y'
                                   and con_sta != 'C'
                                   and con_date BETWEEN '2020-03-01' and '2020-03-31'
                                  ) book_data
                        on pro_data.pro_id = book_data.pro_id
                        Left join (select sell_id 
                                   ,sum(oth_pay_amt) as other_pay_amount
                                   ,GROUP_CONCAT(oth_pay_des SEPARATOR ' - ') as other_pay_des
                                   ,GROUP_CONCAT(DATE_FORMAT(oth_pay_date, '%d/%m/%Y') SEPARATOR '-') as other_pay_date 
                                   from tbl_other_payment
                                   where tbl_other_payment.useYn = 'Y'
                                   GROUP BY sell_id
                        		  ) other_pay
                        on sell_data.sell_id = other_pay.sell_id
                        Left join (select sell_id 
                                   ,GROUP_CONCAT(cus_nm_kh SEPARATOR ' - ') as cus_nm
                                   from tbl_sell_customer
                                   inner join tbl_customer on tbl_customer.cus_id = tbl_sell_customer.cus_id
                                   where tbl_sell_customer.useYn = 'Y'
                                   GROUP BY sell_id
                        		  ) cus_sell_data
                        on sell_data.sell_id = cus_sell_data.sell_id
                        Left join (select con_id 
                                   ,GROUP_CONCAT(cus_nm_kh SEPARATOR ' - ') as cus_nm
                                   from tbl_contract_customer
                                   inner join tbl_customer on tbl_customer.cus_id = tbl_contract_customer.cus_id
                                   where tbl_contract_customer.useYn = 'Y'
                                   GROUP BY con_id
                        		  ) cus_book_data
                        on book_data.con_id = cus_book_data.con_id
                        order by pro_data.pro_code asc